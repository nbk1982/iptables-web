# iptables Notes and Concepts

This file provides a practical primer on firewall basics, netfilter/iptables architecture, and common command usage.

## 1. What is a Firewall?

A firewall enforces predefined security rules on inbound and outbound traffic. It helps block unauthorized access, reduce attack surface, and restrict risky network behavior.

- **Hardware firewall**: high performance and high cost, often implemented as dedicated hardware + software.
- **Software firewall**: lower cost and flexible deployment, running on general-purpose hosts.

## 2. Netfilter and iptables

- **Netfilter** is the Linux kernel packet-processing framework.
- **iptables** is a user-space CLI that configures netfilter rules.
- For IPv6, use **ip6tables**.

Netfilter hook points:

- `PREROUTING`
- `INPUT`
- `FORWARD`
- `OUTPUT`
- `POSTROUTING`

## 3. Chains and Tables

### Chains

- `INPUT`: traffic destined for the local host
- `OUTPUT`: traffic generated by the local host
- `FORWARD`: traffic routed through the host
- `PREROUTING`: before routing decision
- `POSTROUTING`: after routing decision

### Tables

- `filter`: packet filtering (`ACCEPT`, `DROP`, `REJECT`)
- `nat`: address translation (`SNAT`, `DNAT`, `MASQUERADE`, `REDIRECT`)
- `mangle`: packet alteration (TOS/TTL/marks)
- `raw`: connection-tracking bypass controls

Typical table processing order at a hook:

`raw -> mangle -> nat -> filter`

## 4. Rule Structure

Rules are combinations of conditions and actions:

```bash
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

Common matches:

- `-i` / `-o`: incoming/outgoing interface
- `-p`: protocol
- `-s` / `-d`: source/destination address
- `--sport` / `--dport`: source/destination port
- `-m`: match extension module

Common targets:

- `ACCEPT`
- `DROP`
- `REJECT`
- `LOG`
- `SNAT`
- `DNAT`
- `MASQUERADE`
- `REDIRECT`

## 5. Service Management Notes

On modern distributions, firewall service control is often done through `systemctl`. Keep in mind:

- `iptables` itself is not a standalone daemon process.
- Rules are enforced by kernel netfilter modules.
- User-space tools only modify kernel rules.

## 6. Querying Rules

```bash
iptables -L
iptables -L INPUT -n -v --line-numbers
iptables -t nat -L -n -v
```

Flags:

- `-L`: list rules
- `-t`: select table
- `-n`: numeric output
- `-v`: verbose output

## 7. Persistence and Operations

Useful operational commands:

```bash
iptables-save > /etc/iptables/rules.v4
ip6tables-save > /etc/iptables/rules.v6
iptables-restore < /etc/iptables/rules.v4
ip6tables-restore < /etc/iptables/rules.v6
```

For a concise command list, see `docs/iptables-command-reference.md`.